<VirtualHost *:80>
  ServerName proxy
  # Normalise Cookie: remove noisy cookies: Google Analytics.
  RequestHeader edit* Cookie "__utm.=.*?(?:$|;\s*)" ""
  # Unset the header if we've no cookies left.
  RequestHeader unset Cookie "expr=-z %{req:Cookie}"

  # Cart: Vary on the cart hash
  SetEnvIf Cookie woocommerce_cart_hash=([[:xdigit:]]+) WOOCOMMERCE_CART_HASH=$1
  RequestHeader set X-Woocommerce-Cart-Hash none env=!WOOCOMMERCE_CART_HASH
  RequestHeader set X-Woocommerce-Cart-Hash %{WOOCOMMERCE_CART_HASH}e env=WOOCOMMERCE_CART_HASH

  # Session, Vary on the session's customer ID
  SetEnvIf Cookie wp_woocommerce_session_(?:[[:xdigit:]]+)=([[:xdigit:]]+) WOOCOMMERCE_SESSION_CUSTOMER=$1
  RequestHeader set X-Woocommerce-Session-Customer anonymous env=!WOOCOMMERCE_SESSION_CUSTOMER
  RequestHeader set X-Woocommerce-Session-Customer %{WOOCOMMERCE_SESSION_CUSTOMER}e env=WOOCOMMERCE_SESSION_CUSTOMER

  ProxyPass / http://127.0.0.2/
  ProxyPreserveHost On

  # Remove the Vary headers used by the cache, don't forget to remove the commas too.
  Header edit* Vary X-Woocommerce-(?:Cart-Hash|Session-Customer),? ""
  Header edit* Vary X-Forwarded-Proto,? ""

  # Unset the Vary header if it's empty.
  Header unset Vary "expr=-z %{resp:Vary}"

  # Output some interesting performance stats.
  Header always set X-Performance "%D %t %l %i %b"

</VirtualHost>
